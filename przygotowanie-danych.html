<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>2 Przygotowanie danych | Eksploracja danych</title>
  <meta name="description" content="Książka stanowi materiał źródłowy do przeprowadzenia przedmiotu Eksploracja Danych.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="2 Przygotowanie danych | Eksploracja danych" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Książka stanowi materiał źródłowy do przeprowadzenia przedmiotu Eksploracja Danych." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Przygotowanie danych | Eksploracja danych" />
  
  <meta name="twitter:description" content="Książka stanowi materiał źródłowy do przeprowadzenia przedmiotu Eksploracja Danych." />
  

<meta name="author" content="Dariusz Majerek">


<meta name="date" content="2019-02-25">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="roz1.html">
<link rel="next" href="methods.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Eksploracja Danych</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Wstęp</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#o-ksiazce"><i class="fa fa-check"></i>O książce</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#zakres-przedmiotu"><i class="fa fa-check"></i>Zakres przedmiotu</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#zakres-technik-stosowanych-w-data-mining"><i class="fa fa-check"></i>Zakres technik stosowanych w data mining</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#etapy-eksploracji-danych"><i class="fa fa-check"></i>Etapy eksploracji danych</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="roz1.html"><a href="roz1.html"><i class="fa fa-check"></i><b>1</b> Import danych</a><ul>
<li class="chapter" data-level="1.1" data-path="roz1.html"><a href="roz1.html#przyk1"><i class="fa fa-check"></i><b>1.1</b> Przykład</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="przygotowanie-danych.html"><a href="przygotowanie-danych.html"><i class="fa fa-check"></i><b>2</b> Przygotowanie danych</a><ul>
<li class="chapter" data-level="2.1" data-path="przygotowanie-danych.html"><a href="przygotowanie-danych.html#korekta-zbioru-danych"><i class="fa fa-check"></i><b>2.1</b> Korekta zbioru danych</a><ul>
<li class="chapter" data-level="2.1.1" data-path="przygotowanie-danych.html"><a href="przygotowanie-danych.html#identyfikacja-brakow-danych"><i class="fa fa-check"></i><b>2.1.1</b> Identyfikacja braków danych</a></li>
<li class="chapter" data-level="2.1.2" data-path="przygotowanie-danych.html"><a href="przygotowanie-danych.html#zastepowanie-brakow-danych"><i class="fa fa-check"></i><b>2.1.2</b> Zastępowanie braków danych</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="przygotowanie-danych.html"><a href="przygotowanie-danych.html#przykad"><i class="fa fa-check"></i><b>2.2</b> Przykład</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>3</b> Methods</a></li>
<li class="chapter" data-level="4" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>4</b> Applications</a><ul>
<li class="chapter" data-level="4.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>4.1</b> Example one</a></li>
<li class="chapter" data-level="4.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>4.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>5</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="bibliografia.html"><a href="bibliografia.html"><i class="fa fa-check"></i>Bibliografia</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Eksploracja danych</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="przygotowanie-danych" class="section level1">
<h1><span class="header-section-number">2</span> Przygotowanie danych</h1>
<div id="korekta-zbioru-danych" class="section level2">
<h2><span class="header-section-number">2.1</span> Korekta zbioru danych</h2>
<p>Dane, które importujemy z zewnętrznego źródła najczęściej nie spełniają formatów obowiązujących w <strong>R</strong>. Często zmienne zawierają niedopuszczalne znaki szczególne, odstępy w nazwach, powtórzone nazwy kolumn, nazwy zmiennych zaczynające się od liczby, czy puste wiersze lub kolumny. Przed przystąpieniem do analizy zbioru należy rozważyć ewentualne poprawki nazw zmiennych, czy usunięcie pustych kolumn i wierszy. Niektórych czynności można dokonać już na etapie importu danych, stosując pewne pakiety oraz nowe funkcjonalności środowiska <strong>RStudio</strong>. W większości przypadków uchroni nas to od żmudnego przekształcania typów zmiennych. Oczywiście wszystkie te czynności czyszczenia danych można również dokonać już po imporcie danych, za pomocą odpowiednich komend <strong>R</strong>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## przykładowe niepożądane nazwy zmiennych</span>
test_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">18</span>),<span class="dt">ncol =</span> <span class="dv">6</span>))
<span class="kw">names</span>(test_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;hIgHlo&quot;</span>, <span class="st">&quot;REPEAT VALUE&quot;</span>, <span class="st">&quot;REPEAT VALUE&quot;</span>,
                    <span class="st">&quot;% successful (2009)&quot;</span>,  <span class="st">&quot;abc@!*&quot;</span>, <span class="st">&quot;&quot;</span>)
test_df</code></pre>
<pre><code>##       hIgHlo REPEAT VALUE REPEAT VALUE % successful (2009)     abc@!*
## 1 -0.9546709    0.1552327   -1.9070184           1.0976691  0.9381296
## 2  0.2515073    1.5496371   -0.3919635          -0.8297448 -1.3222560
## 3 -0.1100726   -0.5823125    2.2131383          -1.2403419 -1.9700163
##             
## 1 -1.5336062
## 2  1.3299777
## 3 -0.8424698</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## do poprawy nazw zmiennych użyjemy funkcji make.names</span>
<span class="kw">names</span>(test_df) &lt;-<span class="st"> </span><span class="kw">make.names</span>(<span class="kw">names</span>(test_df))
test_df</code></pre>
<pre><code>##       hIgHlo REPEAT.VALUE REPEAT.VALUE X..successful..2009.     abc...
## 1 -0.9546709    0.1552327   -1.9070184            1.0976691  0.9381296
## 2  0.2515073    1.5496371   -0.3919635           -0.8297448 -1.3222560
## 3 -0.1100726   -0.5823125    2.2131383           -1.2403419 -1.9700163
##            X
## 1 -1.5336062
## 2  1.3299777
## 3 -0.8424698</code></pre>
<p>Efekt końcowy choć skuteczny to nie jest zadowalający. Czyszczenia nazw zmiennych można też dokonać stosując funkcję <code>clean_names</code> pakietu <strong>janitor</strong> <span class="citation">(Firke <a href="#ref-R-janitor">2018</a>)</span>. Pozwala on również na usuwanie pustych wierszy i kolumn, znajdowanie zduplikowanych rekordów, itp.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(janitor)
test_df <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># aby na stałe zmienić nazwy zmiennych trzeba podstawienia</span>
<span class="st">    </span><span class="kw">clean_names</span>()</code></pre>
<pre><code>##     h_ig_hlo repeat_value repeat_value_2 x_successful_2009        abc
## 1 -0.9546709    0.1552327     -1.9070184         1.0976691  0.9381296
## 2  0.2515073    1.5496371     -0.3919635        -0.8297448 -1.3222560
## 3 -0.1100726   -0.5823125      2.2131383        -1.2403419 -1.9700163
##            x
## 1 -1.5336062
## 2  1.3299777
## 3 -0.8424698</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># przykładowe dane</span>
x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">w1=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="ot">NA</span>),<span class="dt">w2=</span><span class="kw">c</span>(<span class="ot">NA</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="ot">NA</span>), <span class="dt">w3=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="ot">NA</span>,<span class="dv">1</span>,<span class="ot">NA</span>))
x</code></pre>
<pre><code>##   w1 w2 w3
## 1  1 NA  1
## 2  4  2 NA
## 3  2  3  1
## 4 NA NA NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">remove_empty</span>(<span class="st">&quot;rows&quot;</span>)</code></pre>
<pre><code>##   w1 w2 w3
## 1  1 NA  1
## 2  4  2 NA
## 3  2  3  1</code></pre>
<div id="identyfikacja-brakow-danych" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Identyfikacja braków danych</h3>
<p>Zanim usuniemy jakiekolwiek braki w zbiorze, powinniśmy je najpierw zidentyfikować, określić ich charakter, a dopiero potem ewentualnie podjąć decyzję o uzupełnianiu braków.</p>
<pre class="sourceCode r"><code class="sourceCode r">algae &lt;-<span class="st"> </span>rio<span class="op">::</span><span class="kw">import</span>(<span class="st">&quot;data/algae.csv&quot;</span>)

<span class="co"># najprościej jest wywołać summary</span>
<span class="kw">summary</span>(algae)</code></pre>
<pre><code>##     season              size              speed                mxPH      
##  Length:200         Length:200         Length:200         Min.   :5.600  
##  Class :character   Class :character   Class :character   1st Qu.:7.700  
##  Mode  :character   Mode  :character   Mode  :character   Median :8.060  
##                                                           Mean   :8.012  
##                                                           3rd Qu.:8.400  
##                                                           Max.   :9.700  
##                                                           NA&#39;s   :1      
##       mnO2              Cl               NO3              NH4          
##  Min.   : 1.500   Min.   :  0.222   Min.   : 0.050   Min.   :    5.00  
##  1st Qu.: 7.725   1st Qu.: 10.981   1st Qu.: 1.296   1st Qu.:   38.33  
##  Median : 9.800   Median : 32.730   Median : 2.675   Median :  103.17  
##  Mean   : 9.118   Mean   : 43.636   Mean   : 3.282   Mean   :  501.30  
##  3rd Qu.:10.800   3rd Qu.: 57.824   3rd Qu.: 4.446   3rd Qu.:  226.95  
##  Max.   :13.400   Max.   :391.500   Max.   :45.650   Max.   :24064.00  
##  NA&#39;s   :2        NA&#39;s   :10        NA&#39;s   :2        NA&#39;s   :2         
##       oPO4             PO4              Chla               a1       
##  Min.   :  1.00   Min.   :  1.00   Min.   :  0.200   Min.   : 0.00  
##  1st Qu.: 15.70   1st Qu.: 41.38   1st Qu.:  2.000   1st Qu.: 1.50  
##  Median : 40.15   Median :103.29   Median :  5.475   Median : 6.95  
##  Mean   : 73.59   Mean   :137.88   Mean   : 13.971   Mean   :16.92  
##  3rd Qu.: 99.33   3rd Qu.:213.75   3rd Qu.: 18.308   3rd Qu.:24.80  
##  Max.   :564.60   Max.   :771.60   Max.   :110.456   Max.   :89.80  
##  NA&#39;s   :2        NA&#39;s   :2        NA&#39;s   :12                       
##        a2               a3               a4               a5        
##  Min.   : 0.000   Min.   : 0.000   Min.   : 0.000   Min.   : 0.000  
##  1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.: 0.000  
##  Median : 3.000   Median : 1.550   Median : 0.000   Median : 1.900  
##  Mean   : 7.458   Mean   : 4.309   Mean   : 1.992   Mean   : 5.064  
##  3rd Qu.:11.375   3rd Qu.: 4.925   3rd Qu.: 2.400   3rd Qu.: 7.500  
##  Max.   :72.600   Max.   :42.800   Max.   :44.600   Max.   :44.400  
##                                                                     
##        a6               a7        
##  Min.   : 0.000   Min.   : 0.000  
##  1st Qu.: 0.000   1st Qu.: 0.000  
##  Median : 0.000   Median : 1.000  
##  Mean   : 5.964   Mean   : 2.495  
##  3rd Qu.: 6.925   3rd Qu.: 2.400  
##  Max.   :77.600   Max.   :31.600  
## </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## wyświetl niekompletne wiersze</span>
algae[<span class="op">!</span><span class="kw">complete.cases</span>(algae),] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<pre><code>##    season  size  speed mxPH mnO2   Cl   NO3 NH4 oPO4 PO4 Chla   a1  a2  a3
## 28 autumn small   high  6.8 11.1 9.00 0.630  20  4.0  NA  2.7 30.3 1.9 0.0
## 38 spring small   high  8.0   NA 1.45 0.810  10  2.5 3.0  0.3 75.8 0.0 0.0
## 48 winter small    low   NA 12.6 9.00 0.230  10  5.0 6.0  1.1 35.5 0.0 0.0
## 55 winter small   high  6.6 10.8   NA 3.245  10  1.0 6.5   NA 24.3 0.0 0.0
## 56 spring small medium  5.6 11.8   NA 2.220   5  1.0 1.0   NA 82.7 0.0 0.0
## 57 autumn small medium  5.7 10.8   NA 2.550  10  1.0 4.0   NA 16.8 4.6 3.9
##      a4  a5  a6  a7
## 28  0.0 2.1 1.4 2.1
## 38  0.0 0.0 0.0 0.0
## 48  0.0 0.0 0.0 0.0
## 55  0.0 0.0 0.0 0.0
## 56  0.0 0.0 0.0 0.0
## 57 11.5 0.0 0.0 0.0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## policz niekompletne wiersze</span>
<span class="kw">nrow</span>(algae[<span class="op">!</span><span class="kw">complete.cases</span>(algae),])</code></pre>
<pre><code>## [1] 16</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## sprawdzenie liczby braków w wierszach</span>
<span class="kw">apply</span>(algae, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</code></pre>
<pre><code>##   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18 
##   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0 
##  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36 
##   0   0   0   0   0   0   0   0   0   1   0   0   0   0   0   0   0   0 
##  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54 
##   0   1   0   0   0   0   0   0   0   0   0   1   0   0   0   0   0   0 
##  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72 
##   2   2   2   2   2   2   2   6   1   0   0   0   0   0   0   0   0   0 
##  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90 
##   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0 
##  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107 108 
##   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0 
## 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 
##   0   0   0   0   0   0   0   1   0   0   0   0   0   0   0   0   0   0 
## 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 
##   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0 
## 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 
##   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   1   0 
## 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 
##   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0 
## 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 
##   0   0   0   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0 
## 199 200 
##   6   0</code></pre>
<p>Wiele ciekawych funkcji do eksploracji danych znajduje się w pakiecie <strong>DMwR</strong> <span class="citation">(Torgo <a href="#ref-R-DMwR">2013</a>)</span>, który został przygotowany przy okacji publikacji książki <em>Data Mining with R</em>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## poszukiwanie wierszy zawierających wiele braków</span>
<span class="co">## w tym przypadku próg wyświetlania ustawiony jest na 0.2</span>
<span class="co">## czyli 20% wszystkich kolumn</span>
<span class="kw">library</span>(DMwR)
<span class="kw">manyNAs</span>(algae)</code></pre>
<pre><code>##  62 199 
##  62 199</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## tworzenie zbioru pozbawionego wierszy zawierających wiele braków</span>
algae2 &lt;-<span class="st"> </span>algae[<span class="op">-</span><span class="kw">manyNAs</span>(algae), ]

<span class="co">## sprawdzamy liczbę wybrakowanych wierszy które pozostały</span>
<span class="kw">nrow</span>(algae2[<span class="op">!</span><span class="kw">complete.cases</span>(algae2),])</code></pre>
<pre><code>## [1] 14</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## usuwamy wszystkie wiersze z brakami</span>
algae3 &lt;-<span class="st"> </span><span class="kw">na.omit</span>(algae)
    
<span class="co">## wyświetl wiersze z brakami</span>
algae3[<span class="op">!</span><span class="kw">complete.cases</span>(algae3),] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<pre><code>##  [1] season size   speed  mxPH   mnO2   Cl     NO3    NH4    oPO4   PO4   
## [11] Chla   a1     a2     a3     a4     a5     a6     a7    
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## liczba pozostałych wybrakowanych wierszy</span>
<span class="kw">nrow</span>(algae3[<span class="op">!</span><span class="kw">complete.cases</span>(algae3),])</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## można oczywiście też ręcznie usuwać wiersze (nie polecam)</span>
algae4 &lt;-<span class="st"> </span>algae[<span class="op">-</span><span class="kw">c</span>(<span class="dv">62</span>,<span class="dv">199</span>),]</code></pre>
<p>Można też zbudować funkcję, która będzie usuwała braki danych wg naszego upodobania.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## najpierw budujemy funkcję i ją kompilujemy aby R mógł ja stosować</span>
<span class="co">## parametr prog ustala próg odcięcia wierszy</span>
czysc.dane &lt;-<span class="st"> </span><span class="cf">function</span>(dt, <span class="dt">prog =</span> <span class="dv">0</span>){
    licz.braki &lt;-<span class="st"> </span><span class="kw">apply</span>(dt, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))
    czyste.dt &lt;-<span class="st"> </span>dt[<span class="op">!</span>(licz.braki<span class="op">/</span><span class="kw">ncol</span>(dt)<span class="op">&gt;</span>prog), ]
    <span class="kw">return</span>(czyste.dt)
}
    
<span class="co">## potem ją możemy stosować</span>
algae4 &lt;-<span class="st"> </span><span class="kw">czysc.dane</span>(algae)
<span class="kw">nrow</span>(algae4[<span class="op">!</span><span class="kw">complete.cases</span>(algae4),])</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## czyścimy wiersze, których liczba braków przekracza 20% wszystkich kolumn</span>
algae5 &lt;-<span class="st"> </span><span class="kw">czysc.dane</span>(algae, <span class="dt">prog =</span> <span class="fl">0.2</span>)
<span class="kw">nrow</span>(algae5[<span class="op">!</span><span class="kw">complete.cases</span>(algae5),])</code></pre>
<pre><code>## [1] 14</code></pre>
<p>Bardzo ciekawym narzędziem do znajdowania braków danych jest funkcja <code>md.pattern</code> pakietu <strong>mice</strong> <span class="citation">(van Buuren and Groothuis-Oudshoorn <a href="#ref-R-mice">2018</a>)</span>. Wskazuje on ile braków występuje w ramach każdej zmiennej.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mice)
<span class="kw">md.pattern</span>(algae)</code></pre>
<div class="figure"><span id="fig:mice1"></span>
<img src="EksploracjaDanych_files/figure-html/mice1-1.png" alt="Na czerwono zaznaczone są zmienne, które zwierają braki danych. Liczba w wierszu po lewej stronie wykresu wskazuje ile wierszy w bazie ma daną charakterystykę, a liczba po prawej oznacza ile zmiennych było *wybrakowanych*" width="1056" />
<p class="caption">
Figure 2.1: Na czerwono zaznaczone są zmienne, które zwierają braki danych. Liczba w wierszu po lewej stronie wykresu wskazuje ile wierszy w bazie ma daną charakterystykę, a liczba po prawej oznacza ile zmiennych było <em>wybrakowanych</em>
</p>
</div>
<pre><code>##     season size speed a1 a2 a3 a4 a5 a6 a7 mxPH mnO2 NO3 NH4 oPO4 PO4 Cl
## 184      1    1     1  1  1  1  1  1  1  1    1    1   1   1    1   1  1
## 3        1    1     1  1  1  1  1  1  1  1    1    1   1   1    1   1  1
## 1        1    1     1  1  1  1  1  1  1  1    1    1   1   1    1   1  0
## 7        1    1     1  1  1  1  1  1  1  1    1    1   1   1    1   1  0
## 1        1    1     1  1  1  1  1  1  1  1    1    1   1   1    1   0  1
## 1        1    1     1  1  1  1  1  1  1  1    1    1   0   0    0   0  0
## 1        1    1     1  1  1  1  1  1  1  1    1    0   1   1    1   1  1
## 1        1    1     1  1  1  1  1  1  1  1    1    0   0   0    0   1  0
## 1        1    1     1  1  1  1  1  1  1  1    0    1   1   1    1   1  1
##          0    0     0  0  0  0  0  0  0  0    1    2   2   2    2   2 10
##     Chla   
## 184    1  0
## 3      0  1
## 1      1  1
## 7      0  2
## 1      1  1
## 1      0  6
## 1      1  1
## 1      0  6
## 1      1  1
##       12 33</code></pre>
</div>
<div id="zastepowanie-brakow-danych" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Zastępowanie braków danych</h3>
<p>Zastępowanie braków danych (zwane także <em>imputacją danych</em>) jest kolejnym etapem procesu przygotowania danych do analiz. Nie można jednak wyróżnić uniwersalnego sposobu zastępowania braków dla wszystkich możliwych sytuacji. Wśród statystków panuje przekonanie, że w przypadku wystąpienia braków danych można zastosować trzy strategie:</p>
<ul>
<li>nic nie robić z brakami - co wydaje się niedorzeczne ale wcale takie nie jest, ponieważ istnieje wiele modeli statystycznych (np. drzewa decyzyjne), które świetnie radzą sobie w sytuacji braków danych. Niestety nie jest to sposób, który można stosować zawsze, ponieważ są również modele wymagające kompletności danych jak na przykład sieci neuronowe.</li>
<li>usuwać braki wierszami<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a> - to metoda, która jest stosowana domyślnie w przypadku kiedy twórca modelu nie zadecyduje o innym sposobie obsługi luk. Metoda ta ma swoją niewątpliwą zaletę w postaci jasnej i prostej procedury, ale szczególnie w przypadku niewielkich zbiorów może skutkować obciążeniem estymatorów. Nie wiemy bowiem jaka wartość faktycznie jest przypisana danej cesze. Jeśli jest to wartość bliska np. średniej, to nie wpłynie znacząco na obciążenie estymatora wartości oczekiwanej. W przypadku, gdy różni się ona znacznie od średniej tej cechy, to estymator może już wykazywać obciążenie. Jego wielkość zależy również od liczby usuniętych elementów. Nie jest zalecane usuwanie wielu wierszy ze zbioru danych i na podstawie okrojonego zbioru wyciąganie wniosków o populacji, ponieważ próba jest wówczas znacząco inna niż populacja. Dodatkowo jeśli estymatory są wyznaczane na podstawie zbioru wyraźnie mniej licznego, to precyzja estymatorów wyrażona wariancją spada. Reasumując, jeśli liczba wierszy z brakującymi danymi jest niewielka w stosunku do całego zbioru, to usuwanie wierszy jest sensownym rozwiązaniem.</li>
<li>uzupełnianie braków - to procedura polegająca na zastępowaniu braków różnymi technikami. Jej niewątpliwą zaletą jest fakt posiadania kompletnych danych bez koniczności usuwania wierszy. Niestety wiąże się to również z pewnymi wadami. Zbiór posiadający wiele braków uzupełninych nawet bardzo wyrafinowanymi metodami może cechować się zaniżoną wariancją poszczególnych cech oraz tzw. przeuczeniem<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Uzupełnianie średnią - braki w zakresie danej zmiennej uzupełniamy średnią tej zmiennej przypadków uzupełnionych.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">algae[<span class="kw">is.na</span>(algae<span class="op">$</span>mxPH), ]</code></pre>
<pre><code>##    season  size speed mxPH mnO2 Cl  NO3 NH4 oPO4 PO4 Chla   a1 a2 a3 a4 a5
## 48 winter small   low   NA 12.6  9 0.23  10    5   6  1.1 35.5  0  0  0  0
##    a6 a7
## 48  0  0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">mean</span>(algae<span class="op">$</span>mxPH, <span class="dt">na.rm =</span> T)
algae[<span class="kw">is.na</span>(algae<span class="op">$</span>mxPH), <span class="st">&quot;mxPH&quot;</span>] &lt;-<span class="st"> </span>m
algae[<span class="kw">is.na</span>(algae<span class="op">$</span>mxPH), ]</code></pre>
<pre><code>##  [1] season size   speed  mxPH   mnO2   Cl     NO3    NH4    oPO4   PO4   
## [11] Chla   a1     a2     a3     a4     a5     a6     a7    
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Uzupełnianie medianą - braki w zakresie danej zmiennej uzupełniamy medianą tej zmiennej przypadków uzupełnionych.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">algae <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(Chla)) <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre>
<pre><code>##   season  size  speed mxPH mnO2 Cl   NO3 NH4 oPO4  PO4 Chla   a1  a2  a3
## 1 winter small   high  6.6 10.8 NA 3.245  10    1  6.5   NA 24.3 0.0 0.0
## 2 spring small medium  5.6 11.8 NA 2.220   5    1  1.0   NA 82.7 0.0 0.0
## 3 autumn small medium  5.7 10.8 NA 2.550  10    1  4.0   NA 16.8 4.6 3.9
## 4 spring small   high  6.6  9.5 NA 1.320  20    1  6.0   NA 46.8 0.0 0.0
## 5 summer small   high  6.6 10.8 NA 2.640  10    2 11.0   NA 46.9 0.0 0.0
## 6 autumn small medium  6.6 11.3 NA 4.170  10    1  6.0   NA 47.1 0.0 0.0
##     a4 a5  a6 a7
## 1  0.0  0 0.0  0
## 2  0.0  0 0.0  0
## 3 11.5  0 0.0  0
## 4 28.8  0 0.0  0
## 5 13.4  0 0.0  0
## 6  0.0  0 1.2  0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">algae[<span class="kw">is.na</span>(algae<span class="op">$</span>Chla), <span class="st">&quot;Chla&quot;</span>] &lt;-<span class="st"> </span><span class="kw">median</span>(algae<span class="op">$</span>Chla, <span class="dt">na.rm =</span> T)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Wypełnianie zmiennych typu wyliczeniowego, logicznego lub znakowego odbywa się najczęściej przez dobranie w miejsce brakującej wartości, elementu powtarzającego się najczęściej wśród obiektów obserwowanych. W pakiecie <strong>DMwR</strong> istnieje funkcja <code>centralImputation</code>, która wypełnia braki wartością centralną (w przypadku zmiennych typu liczbowego - medianą, a dla wartości logicznych, wyliczeniowych lub tekstowych - modą).</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">algae[<span class="dv">48</span>, <span class="st">&quot;season&quot;</span>]</code></pre>
<pre><code>## [1] &quot;winter&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">algae[<span class="dv">48</span>, <span class="st">&quot;season&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
algae.uzup &lt;-<span class="st"> </span><span class="kw">centralImputation</span>(algae)
algae.uzup[<span class="dv">48</span>,]</code></pre>
<pre><code>##    season  size speed     mxPH mnO2 Cl  NO3 NH4 oPO4 PO4 Chla   a1 a2 a3
## 48 winter small   low 8.011734 12.6  9 0.23  10    5   6  1.1 35.5  0  0
##    a4 a5 a6 a7
## 48  0  0  0  0</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Jeszcze innym sposobem imputacji danych są algorytmy oparte o metodę <span class="math inline">\(k\)</span>-najbliższych sąsiadów. Algorytm opiera się na prostej zasadzie, uzupełniania brakujących wartości medianą (w przypadku zmiennych ilościowych) lub modą (w przypadku zmiennych jakościowych) elementów, które są <span class="math inline">\(k\)</span>-tymi najbliższymi sąsiadami w metryce
<span class="math display">\[\begin{equation}\label{knn}
 d(x,y)=\sqrt{\sum_{i=1}^{p}\delta_i(x_i,y_i)},
\end{equation}\]</span>
gdzie <span class="math inline">\(\delta_i\)</span> jest odległością pomiędzy dwoma elementami ze względu na <span class="math inline">\(i\)</span>-tą cech, określoną następująco
<span class="math display">\[\begin{equation}\label{metryka}
 \delta_i(v_1, v_2)=\begin{cases}
     1,&amp; \text{jeśli zmienna jest jakościowa i }v_1\neq v_2\\
     0,&amp; \text{jeśli zmienna jest jakościowa i }v_1=v_2\\
     (v_1-v_2)^2,&amp; \text{jeśli zmienna jest ilościowa.}
 \end{cases}
\end{equation}\]</span>
Odległości są mierzone dla zmiennych standaryzowanych. Istnieje też odmiana z wagami, które maleją wraz ze wzrostem odległości pomiędzy sąsiadem a uzupełnianym elementem (np. <span class="math inline">\(w(d)=\exp(d)\)</span>).</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">algae[<span class="dv">48</span>, ]</code></pre>
<pre><code>##    season  size speed     mxPH mnO2 Cl  NO3 NH4 oPO4 PO4 Chla   a1 a2 a3
## 48   &lt;NA&gt; small   low 8.011734 12.6  9 0.23  10    5   6  1.1 35.5  0  0
##    a4 a5 a6 a7
## 48  0  0  0  0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">algae &lt;-<span class="st"> </span>algae <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate_if</span>(is.character, as.factor)
algae.uzup &lt;-<span class="st"> </span><span class="kw">knnImputation</span>(algae, <span class="dt">k =</span> <span class="dv">5</span>, <span class="dt">scale =</span> F, <span class="dt">meth =</span> <span class="st">&quot;median&quot;</span>)
algae.uzup[<span class="dv">48</span>,]</code></pre>
<pre><code>##    season  size speed     mxPH mnO2 Cl  NO3 NH4 oPO4 PO4 Chla   a1 a2 a3
## 48 summer small   low 8.011734 12.6  9 0.23  10    5   6  1.1 35.5  0  0
##    a4 a5 a6 a7
## 48  0  0  0  0</code></pre>
<p>Istnieją również dużo bardziej złożone algorytmy imputacji danych oparte na bardziej wyrafinowanych technikach, takich jak: predykcja modelami liniowymi, nieliniowymi, analiza dyskryminacyjna, drzewa klasyfikacyjne. Dwa najbardziej znane pakiety zawierające funkcje do imputacji w sposób złożony, to <strong>Amelia</strong> i <strong>mice</strong>.</p>
<p>Imputacja danych z zastosowaniem pakietu <strong>mice</strong> wymaga podjęcia kilku decyzji przed przystąpieniem do uzupełniania danych:</p>
<ol style="list-style-type: decimal">
<li>Czy dane są MAR (ang. <em>Missing At Random</em>) czy MNAR (ang. <em>Missing Not At Random</em>), co oznacza, że musimy się zastanowić jakie mogły być źródła braków danych, przypadkowe czy systematyczne?</li>
<li>Należy się zdecydować na formę imputacji, określając strukturę zależności pomiędzy cechami oraz rozkład błędu danej cechy?</li>
<li>Wybrać zbiór danych, który posłuży nam za predyktory w imputacji (nie mogą zawierać braków).</li>
<li>Określenie, które niepełne zmienne są funkcjami innych wybrakowanych zmiennych.</li>
<li>Określić w jakiej kolejności dane będą imputowane.</li>
<li>Określić parametry startowe imputacji (liczbę iteracji, warunek zbieżności).</li>
<li>Określić liczę imputowanych zbiorów.</li>
</ol>
<p>Ad 1. Wyróżniamy nastepujące rodzaje braków danych:
- MCAR (ang. <em>Missing Completely At Random</em>) - z definicji to braki, których pojawienie się jest kompletnie losowe. Przykładowo gdy osoba poproszona o wypełnienie wieku w ankiecie będzie rzucać monetą czy wypełnić tą zmienną.
- MAR - oznacza, że obserwowane wartości i wybrakowane mają inne rozkłady ale da się je oszacować na podstawie danych obserwowanych. Przykładowo ciśnienie tętnicze u osób, które nie wypełniły tej wartości jest wyższe niż u osób, które wpisały swoje ciśnienie. Okazuje się, że osoby starsze z nadciśnieniem nie wypełniały ankiety w tym punkcie.
- MNAR - jeśli nie jest spełniony warunek MCAR i MAR, wówczas brak ma charakter nielosowy. Przykładowo respondenci osiągający wyższe zarobki sukcesywnie nie wypełniają pola “zarobki” i dodatkowo nie ma w ankiecie zmiennych, które pozwoliłyby nam ustalić, jakie to osoby.</p>
<p>Ad 2. Decyzja o algorytmie imputacji wynika bezpośrednio ze skali w jakiej jest mierzona dana zmienna. Ze względu na rodzaj cechy używać będziemy następujących metod:</p>
<table>
<caption><span id="tab:methods">Table 2.1: </span>Zestaw metod imputacji danych stosowanych w pakiecie <strong>mice</strong></caption>
<thead>
<tr class="header">
<th align="left">method</th>
<th align="left">type</th>
<th align="left">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">pmm</td>
<td align="left">any</td>
<td align="left">Predictive.mean.matching</td>
</tr>
<tr class="even">
<td align="left">midastouch</td>
<td align="left">any</td>
<td align="left">Weighted predictive mean matching</td>
</tr>
<tr class="odd">
<td align="left">sample</td>
<td align="left">any</td>
<td align="left">Random sample from observed values</td>
</tr>
<tr class="even">
<td align="left">cart</td>
<td align="left">any</td>
<td align="left">Classification and regression trees</td>
</tr>
<tr class="odd">
<td align="left">rf</td>
<td align="left">any</td>
<td align="left">Random forest imputations</td>
</tr>
<tr class="even">
<td align="left">mean</td>
<td align="left">numeric</td>
<td align="left">Unconditional mean imputation</td>
</tr>
<tr class="odd">
<td align="left">norm</td>
<td align="left">numeric</td>
<td align="left">Bayesian linear regression</td>
</tr>
<tr class="even">
<td align="left">norm.nob</td>
<td align="left">numeric</td>
<td align="left">Linear regression ignoring model error</td>
</tr>
<tr class="odd">
<td align="left">norm.boot</td>
<td align="left">numeric</td>
<td align="left">Linear regression using bootstrap</td>
</tr>
<tr class="even">
<td align="left">norm.predict</td>
<td align="left">numeric</td>
<td align="left">Linear regression, predicted values</td>
</tr>
<tr class="odd">
<td align="left">quadratic</td>
<td align="left">numeric</td>
<td align="left">Imputation of quadratic terms</td>
</tr>
<tr class="even">
<td align="left">ri</td>
<td align="left">numeric</td>
<td align="left">Random indicator for nonignorable data</td>
</tr>
<tr class="odd">
<td align="left">logreg</td>
<td align="left">binary</td>
<td align="left">Logistic regression</td>
</tr>
<tr class="even">
<td align="left">logreg.boot</td>
<td align="left">binary</td>
<td align="left">Logistic regression with bootstrap</td>
</tr>
<tr class="odd">
<td align="left">polr</td>
<td align="left">ordered</td>
<td align="left">Proportional odds model</td>
</tr>
<tr class="even">
<td align="left">polyreg</td>
<td align="left">unordered</td>
<td align="left">Polytomous logistic regression</td>
</tr>
<tr class="odd">
<td align="left">lda</td>
<td align="left">unordered</td>
<td align="left">Linear discriminant analysis</td>
</tr>
<tr class="even">
<td align="left">2l.norm</td>
<td align="left">numeric</td>
<td align="left">Level-1 normal heteroscedastic</td>
</tr>
<tr class="odd">
<td align="left">2l.lmer</td>
<td align="left">numeric</td>
<td align="left">Level-1 normal homoscedastic,</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left">lmer</td>
</tr>
<tr class="odd">
<td align="left">2l.pan</td>
<td align="left">numeric</td>
<td align="left">Level-1 normal homoscedastic, pan</td>
</tr>
<tr class="even">
<td align="left">2l.bin</td>
<td align="left">binary</td>
<td align="left">Level-1 logistic, glmer</td>
</tr>
<tr class="odd">
<td align="left">2lonly.mean</td>
<td align="left">numeric</td>
<td align="left">Level-2 class mean</td>
</tr>
<tr class="even">
<td align="left">2lonly.norm</td>
<td align="left">numeric</td>
<td align="left">Level-2 class normal</td>
</tr>
<tr class="odd">
<td align="left">2lonly.pmm</td>
<td align="left">any</td>
<td align="left">Level-2 class predictive mean matching</td>
</tr>
</tbody>
</table>
<p>Każdy z czterech typów danych ma swój domyślny algorytm przeznaczony do imputacji:
- zmienna ilościowa - <code>pmm</code>
- zmienna dychotomiczna (stany 0 lub 1) - <code>logreg</code>
- zmienna typu wyliczeniowego (nieuporządkowana) - <code>polyreg</code>
- zmienna typu wyliczeniowego (uporządkowana) - <code>polr</code></p>
<p>Niewątpliwą zaletą metody <code>pmm</code> jest to, że wartości imputowane są ograniczone jedynie do obserwowanych wartości. Metody <code>norm</code> i <code>norm.nob</code> uzupełniają brakujące wartości w oparciu o model liniowy. Są one szybkie i efektywne w przypadku gdy reszty modelu są zbliżone rozkładem do normalności. Druga z tych technik nie bierze pod uwagę niepewności związanej z modelem imputującym. Metoda <code>2L.norm</code> opiera się na dwupoziomowym heterogenicznym modelu liniowym (skupienia są włączone jako efekt do modelu). Technika <code>polyreg</code> korzysta z funkcji <code>multinom</code> pakietu <strong>nnet</strong> tworzącej model wielomianowy. <code>polr</code> opiera się o proporcjonalny model logitowy z pakietu <strong>MASS</strong>. <code>lda</code> to model dyskryminacyjny klasyfikujący obiekty na podstawie prawdopodobieństw <em>a posteriori</em>. Metoda <code>sample</code> zastępuje braki losowa wybranymi wartościami spośród wartości obserwowanych.</p>
<p>Ad 3. Do ustalenia predyktorów w modelu <code>mice</code> służy funkcja <code>predictorMatrix</code>. Po pierwsze wyświetla ona domyślny układ predyktorów włączanych do modelu. Można go dowolnie zmienić i podstawić do modelu imputującego dane parametrem <code>predictorMatrix</code>. Zera występujące w kolejnych wierszach macierzy predyktorów oznaczają pominięcie tej zmiennej przy imputacji innej zmiennej. Jeśli dodatkowo chcemy by jakaś zmienna nie była imputowana, to oprócz usunięcia jej z listy predyktorów, należy wymazać ją z listy metod predykcji (<code>method</code>).</p>
<p>Ogólne zalecenia co do tego jakie zmienne stosować jako predyktory jest takie, żeby brać ich jak najwięcej. Spowoduje to, że bardziej prawdopodobny staje się brak typu MAR a nie MNAR. Z drugiej jednak strony, nierzadko zbiory zawierają olbrzymią liczbę zmiennych i włączanie ich wszystkich do modelu imputującego nie będzie miało sensu.</p>
<p>Zalecenia doboru zmiennych są następujące:
- weź wszystkie te zmienne, które są włączane do modelu właściwego, czyli tego za pomocą którego chcesz poznać strukturę zależności;
- czasem do modelu imputującego należy też włączyć interakcje zmiennych z modelu właściwego;
- dodaj zmienne, które mogą mieć wpływ na wybrakowane cechy;
- włącz zmienne istotnie podnoszące poziom wyjaśnionej wariancji modelu;
- na koniec usuń te zmienne spośród predyktorów, które same zawierają zbyt wiele braków.</p>
<p>Ad 4-7. Decyzje podejmowane w tych punktach zależą istotnie od analizowanego zbioru i będą przedmiotem oddzielnych analiz w kontekście rozważanych zbiorów i zadań.</p>
</div>
</div>
<div id="przykad" class="section level2">
<h2><span class="header-section-number">2.2</span> Przykład</h2>
<p>Dokonamy imputacji zbioru <code>airquality</code> z wykorzystaniem pakietów <strong>mice</strong> i <strong>VIM</strong> <span class="citation">(Templ et al. <a href="#ref-R-VIM">2019</a>)</span></p>
<pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>airquality
<span class="kw">summary</span>(data)</code></pre>
<pre><code>##      Ozone           Solar.R           Wind             Temp      
##  Min.   :  1.00   Min.   :  7.0   Min.   : 1.700   Min.   :56.00  
##  1st Qu.: 18.00   1st Qu.:115.8   1st Qu.: 7.400   1st Qu.:72.00  
##  Median : 31.50   Median :205.0   Median : 9.700   Median :79.00  
##  Mean   : 42.13   Mean   :185.9   Mean   : 9.958   Mean   :77.88  
##  3rd Qu.: 63.25   3rd Qu.:258.8   3rd Qu.:11.500   3rd Qu.:85.00  
##  Max.   :168.00   Max.   :334.0   Max.   :20.700   Max.   :97.00  
##  NA&#39;s   :37       NA&#39;s   :7                                       
##      Month            Day      
##  Min.   :5.000   Min.   : 1.0  
##  1st Qu.:6.000   1st Qu.: 8.0  
##  Median :7.000   Median :16.0  
##  Mean   :6.993   Mean   :15.8  
##  3rd Qu.:8.000   3rd Qu.:23.0  
##  Max.   :9.000   Max.   :31.0  
## </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># tworzymy dodatkowe braki danych</span>
data[<span class="dv">4</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>,<span class="dv">7</span>)
data[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
<span class="kw">summary</span>(data)</code></pre>
<pre><code>##      Ozone           Solar.R           Wind             Temp      
##  Min.   :  1.00   Min.   :  7.0   Min.   : 1.700   Min.   :57.00  
##  1st Qu.: 18.00   1st Qu.:115.8   1st Qu.: 7.400   1st Qu.:73.00  
##  Median : 31.50   Median :205.0   Median : 9.700   Median :79.00  
##  Mean   : 42.13   Mean   :185.9   Mean   : 9.806   Mean   :78.28  
##  3rd Qu.: 63.25   3rd Qu.:258.8   3rd Qu.:11.500   3rd Qu.:85.00  
##  Max.   :168.00   Max.   :334.0   Max.   :20.700   Max.   :97.00  
##  NA&#39;s   :37       NA&#39;s   :7       NA&#39;s   :7        NA&#39;s   :5      
##      Month            Day      
##  Min.   :5.000   Min.   : 1.0  
##  1st Qu.:6.000   1st Qu.: 8.0  
##  Median :7.000   Median :16.0  
##  Mean   :6.993   Mean   :15.8  
##  3rd Qu.:8.000   3rd Qu.:23.0  
##  Max.   :9.000   Max.   :31.0  
## </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">md.pattern</span>(data)</code></pre>
<p><img src="EksploracjaDanych_files/figure-html/unnamed-chunk-3-1.png" width="1056" /></p>
<pre><code>##     Month Day Temp Solar.R Wind Ozone   
## 104     1   1    1       1    1     1  0
## 34      1   1    1       1    1     0  1
## 3       1   1    1       1    0     1  1
## 1       1   1    1       1    0     0  2
## 4       1   1    1       0    1     1  1
## 1       1   1    1       0    1     0  2
## 1       1   1    1       0    0     1  2
## 3       1   1    0       1    1     1  1
## 1       1   1    0       1    0     1  2
## 1       1   1    0       0    0     0  4
##         0   0    5       7    7    37 56</code></pre>
<p>Do ilustracji braków danych można zastosować funkcje pakietu <strong>VIM</strong>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(VIM)
<span class="kw">aggr</span>(data, <span class="dt">numbers=</span><span class="ot">TRUE</span>, 
     <span class="dt">sortVars=</span><span class="ot">TRUE</span>, 
     <span class="dt">labels=</span><span class="kw">names</span>(data), 
     <span class="dt">cex.axis=</span>.<span class="dv">7</span>)</code></pre>
<p><img src="EksploracjaDanych_files/figure-html/unnamed-chunk-4-1.png" width="1056" /></p>
<pre><code>## 
##  Variables sorted by number of missings: 
##  Variable      Count
##     Ozone 0.24183007
##   Solar.R 0.04575163
##      Wind 0.04575163
##      Temp 0.03267974
##     Month 0.00000000
##       Day 0.00000000</code></pre>
<p>Tak przedstawia się wykres rozrzutu zmiennych <code>Ozone</code> i <code>Solar.R</code> z uwzględnieniem położenia braków danych.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">marginplot</span>(data[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</code></pre>
<p><img src="EksploracjaDanych_files/figure-html/unnamed-chunk-5-1.png" width="1056" /></p>
<p>Dokonamy imputacji metodą <code>pmm</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">tempData &lt;-<span class="st"> </span><span class="kw">mice</span>(data, 
                 <span class="dt">maxit=</span><span class="dv">50</span>, 
                 <span class="dt">meth=</span><span class="st">&#39;pmm&#39;</span>, 
                 <span class="dt">seed=</span><span class="dv">44</span>, 
                 <span class="dt">printFlag =</span> F)
<span class="kw">summary</span>(tempData)</code></pre>
<pre><code>## Class: mids
## Number of multiple imputations:  5 
## Imputation methods:
##   Ozone Solar.R    Wind    Temp   Month     Day 
##   &quot;pmm&quot;   &quot;pmm&quot;   &quot;pmm&quot;   &quot;pmm&quot;      &quot;&quot;      &quot;&quot; 
## PredictorMatrix:
##         Ozone Solar.R Wind Temp Month Day
## Ozone       0       1    1    1     1   1
## Solar.R     1       0    1    1     1   1
## Wind        1       1    0    1     1   1
## Temp        1       1    1    0     1   1
## Month       1       1    1    1     0   1
## Day         1       1    1    1     1   0</code></pre>
<p>Ponieważ, funkcja <code>mice</code> domyślnie dokonuje 5 kompletnych imputacji, możmy się przekonać jak bardzo różnią się poszczególne imputacje i zdecydować się na jedną z nich.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(tempData<span class="op">$</span>imp<span class="op">$</span>Ozone)</code></pre>
<pre><code>##     1  2  3  4  5
## 5  21 20  7 36 13
## 10 21 16 44 22 21
## 25 14 14 14  6  8
## 26 23 18  8 19 14
## 27 37 23 21  7  9
## 32 63 23  7 52 39</code></pre>
<p>Ostatecznie imputacji dokonujemy wybierając jeden z zestawów danych uzupełniających (np. pierszy).</p>
<pre class="sourceCode r"><code class="sourceCode r">completedData &lt;-<span class="st"> </span>mice<span class="op">::</span><span class="kw">complete</span>(tempData, <span class="dv">1</span>)
<span class="kw">summary</span>(completedData)</code></pre>
<pre><code>##      Ozone          Solar.R           Wind             Temp      
##  Min.   :  1.0   Min.   :  7.0   Min.   : 1.700   Min.   :57.00  
##  1st Qu.: 20.0   1st Qu.:115.0   1st Qu.: 7.400   1st Qu.:73.00  
##  Median : 32.0   Median :212.0   Median : 9.700   Median :79.00  
##  Mean   : 42.5   Mean   :187.9   Mean   : 9.931   Mean   :78.14  
##  3rd Qu.: 59.0   3rd Qu.:259.0   3rd Qu.:11.500   3rd Qu.:85.00  
##  Max.   :168.0   Max.   :334.0   Max.   :20.700   Max.   :97.00  
##      Month            Day      
##  Min.   :5.000   Min.   : 1.0  
##  1st Qu.:6.000   1st Qu.: 8.0  
##  Median :7.000   Median :16.0  
##  Mean   :6.993   Mean   :15.8  
##  3rd Qu.:8.000   3rd Qu.:23.0  
##  Max.   :9.000   Max.   :31.0</code></pre>
<p>Za pomocą funkcji pakietu <code>mice</code> możemy również przedstawić graficznie gdzi jak zostały uzupełnione dane.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">densityplot</span>(tempData, <span class="op">~</span>Ozone<span class="op">+</span>Solar.R<span class="op">+</span>Wind<span class="op">+</span>Temp)</code></pre>
<p><img src="EksploracjaDanych_files/figure-html/unnamed-chunk-9-1.png" width="1056" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stripplot</span>(tempData, Ozone<span class="op">+</span>Solar.R<span class="op">+</span>Wind<span class="op">+</span>Temp<span class="op">~</span>.imp, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="fl">1.2</span>)</code></pre>
<p><img src="EksploracjaDanych_files/figure-html/unnamed-chunk-9-2.png" width="1056" /></p>

</div>
</div>
<h3>Bibliografia</h3>
<div id="refs" class="references">
<div id="ref-R-janitor">
<p>Firke, Sam. 2018. <em>Janitor: Simple Tools for Examining and Cleaning Dirty Data</em>. <a href="https://CRAN.R-project.org/package=janitor">https://CRAN.R-project.org/package=janitor</a>.</p>
</div>
<div id="ref-R-DMwR">
<p>Torgo, Luis. 2013. <em>DMwR: Functions and Data for &quot;Data Mining with R&quot;</em>. <a href="https://CRAN.R-project.org/package=DMwR">https://CRAN.R-project.org/package=DMwR</a>.</p>
</div>
<div id="ref-R-mice">
<p>van Buuren, Stef, and Karin Groothuis-Oudshoorn. 2018. <em>Mice: Multivariate Imputation by Chained Equations</em>. <a href="https://CRAN.R-project.org/package=mice">https://CRAN.R-project.org/package=mice</a>.</p>
</div>
<div id="ref-R-VIM">
<p>Templ, Matthias, Alexander Kowarik, Andreas Alfons, and Bernd Prantner. 2019. <em>VIM: Visualization and Imputation of Missing Values</em>. <a href="https://CRAN.R-project.org/package=VIM">https://CRAN.R-project.org/package=VIM</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="11">
<li id="fn11"><p>polega na usuwaniu wierszy zawierających braki<a href="przygotowanie-danych.html#fnref11" class="footnote-back">↩</a></p></li>
<li id="fn12"><p>więcej o zjawisku przeuczneia w dalszej części książki<a href="przygotowanie-danych.html#fnref12" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="roz1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["EksploracjaDanych.pdf", "EksploracjaDanych.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
